<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“˜AIãƒãƒ¼ãƒˆæ•´ç†ãã‚“ï¼ˆAIè¦ç´„ç‰ˆï¼‰</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 40px auto; }
    h1 { text-align: center; }
    textarea { width: 100%; height: 200px; margin-top: 10px; }
    button { margin-top: 10px; padding: 8px 16px; }
  </style>
</head>
<body>
  <h1>ğŸ“˜AIãƒãƒ¼ãƒˆæ•´ç†ãã‚“ï¼ˆAIè¦ç´„ç‰ˆï¼‰</h1>
  <p>ãƒ¡ãƒ¢ã‚„æ•™ç§‘æ›¸ã®å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</p>

  <input type="file" id="fileInput" accept="image/*"><br>
  <button id="extractBtn">AIã§æ•´ç†ã™ã‚‹</button>

  <h3>ã€æŠ½å‡ºã•ã‚ŒãŸæ–‡å­—ã€‘</h3>
  <textarea id="extractedText"></textarea>

  <h3>ã€AIæ•´ç†çµæœã€‘</h3>
  <textarea id="aiSummary"></textarea>

  <script>
  document.getElementById("extractBtn").onclick = async () => {
    const file = document.getElementById("fileInput").files[0];
    if (!file) { alert("ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„"); return; }

    // --- OCRå‡¦ç† ---
    const formData = new FormData();
    formData.append("file", file);
    formData.append("apikey", "helloworld"); // ocr.space ç„¡æ–™ã‚­ãƒ¼
    formData.append("language", "jpn");

    const ocrResponse = await fetch("https://api.ocr.space/parse/image", {
      method: "POST",
      body: formData
    });
    const ocrResult = await ocrResponse.json();
    const text = ocrResult.ParsedResults?.[0]?.ParsedText || "(æ–‡å­—ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸ)";
    document.getElementById("extractedText").value = text;

    // --- ChatGPTã§æ•´ç† ---
    const apiKey = prompt("ã‚ãªãŸã®OpenAI APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆå®‰å…¨ã§ã™ï¼‰:");
    const aiResponse = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: "gpt-4o-mini",
        messages: [{
          role: "system",
          content: "ã‚ãªãŸã¯å„ªç§€ãªãƒãƒ¼ãƒˆæ•´ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚OCRæ–‡å­—ã‚’æ•´ç†ã—ã¦ã€è¦‹ã‚„ã™ã„ãƒãƒ¼ãƒˆå½¢å¼ã«ã—ã¦ãã ã•ã„ã€‚"
        },{
          role: "user",
          content: text
        }]
      })
    });
    const data = await aiResponse.json();
    document.getElementById("aiSummary").value = data.choices[0].message.content;
  };
  </script>
</body>
</html>
